# AI Guidelines: Inde Backend Project

ë³¸ ë¬¸ì„œëŠ” Inde Backend ê°œë°œ ì‹œ AIê°€ í•­ìƒ ì¼ê´€ëœ êµ¬ì¡°ì™€ ì•„í‚¤í…ì²˜ íŒ¨í„´ì„ ë”°ë¥´ë„ë¡ ì•ˆë‚´í•˜ê¸° ìœ„í•œ ê°€ì´ë“œë¼ì¸ì´ë‹¤.

---

## 1. ì•„í‚¤í…ì²˜ ê°œìš”
- í”„ë¡œì íŠ¸ëŠ” **ë©€í‹°ì‚¬ì´íŠ¸(Multi-Site) ì•„í‚¤í…ì²˜**ë¥¼ ì±„íƒí•œë‹¤.
- ìš”ì²­ì˜ **ë„ë©”ì¸(Host í—¤ë”)**ì— ë”°ë¼ ë¼ìš°íŒ…ê³¼ ì •ì±…ì„ ë¶„ë¦¬í•˜ëŠ” **ë„ë©”ì¸ ê¸°ë°˜ ë¼ìš°íŒ… êµ¬ì¡° (Domain-based routing)**ë¥¼ ì‚¬ìš©í•œë‹¤.
- ê° ë„ë©”ì¸ì€ ë…ë¦½ëœ URLConf, ì¸ì¦ ì •ì±…, CORS ì„¤ì •, ë¯¸ë””ì–´ prefixë¥¼ ê°€ì§„ë‹¤.
- `sites/` ë””ë ‰í† ë¦¬ í•˜ìœ„ì— ì‚¬ì´íŠ¸ë³„ ë…ë¦½ ëª¨ë“ˆì„ ë‘ëŠ” ë°©ì‹ì„ **ì‚¬ì´íŠ¸ ëª¨ë“ˆ ë¶„ë¦¬(Site-specific modular structure)**ë¼ê³  ì •ì˜í•œë‹¤.

---

## 2. ë””ë ‰í† ë¦¬ êµ¬ì¡° ì›ì¹™
backend/
config/ # ê¸€ë¡œë²Œ ì„¤ì • ë° ê³µìš© ë¯¸ë“¤ì›¨ì–´
settings/ # í™˜ê²½ë³„ ì„¸íŒ… (base/local/dev/prod)
site_router.py # ë„ë©”ì¸ â†” URLConf ë§¤í•‘
middleware.py # CurrentSiteMiddleware
urls.py # ê¸€ë¡œë²Œ URL (healthz ë“± ìµœì†Œ)
core/ # ê³µí†µ ìœ í‹¸ë¦¬í‹°, ì„œë¹„ìŠ¤, ë² ì´ìŠ¤ ëª¨ë¸
admin_api/ # ê´€ë¦¬ì API ì „ìš© (admin_api.Inde.com)
public_api/ # ì›¹ì‚¬ì´íŠ¸ API ì „ìš© (api.Inde.com)



---

## 3. ë¼ìš°íŒ… ë°©ì‹
- `CurrentSiteMiddleware`ê°€ Host í—¤ë”ë¥¼ í™•ì¸í•˜ê³ , `site_router.py`ì˜ **SITE_MAP**ì„ ì°¸ì¡°í•˜ì—¬ URLConfë¥¼ ë™ì ìœ¼ë¡œ ì„ íƒí•œë‹¤.
- ë§¤í•‘ ê·œì¹™:
  - `admin_api.inde.kr` â†’ `sites.admin_api.urls`
  - `api.inde.kr` â†’ `sites.public_api.urls`

---

## 4. ë°ì´í„° ìŠ¤ì½”í”„ ê·œì¹™
1. ëª¨ë“  ì£¼ìš” ëª¨ë¸ì€ `site_id`(ë˜ëŠ” `site_slug`) í•„ë“œë¥¼ ê°€ì ¸ì•¼ í•œë‹¤.  
   â†’ ê° ì‚¬ì´íŠ¸ì˜ ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ë¶„ë¦¬ëœë‹¤.
2. ì¡°íšŒ/ìƒì„± ì‹œ `request.site_meta['slug']`ë¥¼ í™œìš©í•´ ìë™ í•„í„°ë§í•œë‹¤.
3. í•„ìš” ì‹œ ê³µí†µ User(Account) ëª¨ë¸ + ì‚¬ì´íŠ¸ë³„ Member í…Œì´ë¸”ì„ ë¶„ë¦¬í•˜ì—¬ ì¸ì¦ ì •ì±…ì„ ë‹¬ë¦¬ ì ìš©í•œë‹¤.

---

## 5. ì„¤ì • ê´€ë¦¬
- **í™˜ê²½ë³„ ì„¤ì •**: `config/settings/{base,local,dev,prod}.py`
- **í™˜ê²½ ë³€ìˆ˜ íŒŒì¼**: `env/{local,dev,prod}/.env` í˜•íƒœë¡œ ê´€ë¦¬
- **ë°ì´í„°ë² ì´ìŠ¤**: **ë§ˆë¦¬ì•„DB(MySQL)** ì‚¬ìš©
  - ë¡œì»¬: `env/local/.env`ì˜ DB ì„¤ì • ì‚¬ìš©
  - ê°œë°œ/í”„ë¡œë•ì…˜: ê° í™˜ê²½ë³„ `.env` íŒŒì¼ì˜ DB ì„¤ì • ì‚¬ìš©
- **ì‚¬ì´íŠ¸ë³„ ë™ì  ì„¤ì •**:
  - `SITE_MAP`ì—ì„œ `cors`, `media_prefix`, ì¸ì¦ ì˜µì…˜ì„ ì‚¬ì´íŠ¸ë³„ë¡œ ì •ì˜
  - í•„ìš” ì‹œ DBì˜ `SiteConfig` í…Œì´ë¸”ë¡œ í™•ì¥ ê°€ëŠ¥

---

## 6. ì¸ì¦ & ê¶Œí•œ
- ëª¨ë“  ì‚¬ì´íŠ¸ëŠ” ê³µí†µ `Account` ëª¨ë¸ì„ ì‚¬ìš©í•œë‹¤.
  - `core.Account`: í™•ì¥ëœ ì‚¬ìš©ì ëª¨ë¸ (UUID, ì „í™”ë²ˆí˜¸, ìƒë…„ì›”ì¼, ì´ë©”ì¼ ì¸ì¦ ë“±)
  - `core.AuditLog`: ì‚¬ìš©ì í™œë™ ìë™ ë¡œê¹… (ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ, CRUD ì‘ì—…)
- ì‚¬ì´íŠ¸ë³„ ìš”êµ¬ì‚¬í•­ì´ ë‹¤ë¥¸ ê²½ìš° `Member` í…Œì´ë¸”ì„ ë³„ë„ ì •ì˜í•˜ê³  `Account`ì™€ ì—°ê²°í•œë‹¤.
- ì¸ì¦ ë¡œì§ì€ `CurrentSiteMiddleware`ë¡œ ì£¼ì…ëœ `site_slug`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ì´íŠ¸ë³„ë¡œ ë¶„ê¸°í•œë‹¤.
- ì˜ˆ:
  - **admin_api**: ê´€ë¦¬ì ê¶Œí•œ í•„ìš” (`is_staff`, `is_superuser`) - âœ… êµ¬í˜„ ì™„ë£Œ
  - **public_api**: ì¼ë°˜ íšŒì› ì¸ì¦  

---

## 7. CORS ë° ë¯¸ë””ì–´
- CORS í—ˆìš© ë„ë©”ì¸ì€ `SITE_MAP['cors']` ê°’ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ê²°ì •í•œë‹¤.
- íŒŒì¼ ì—…ë¡œë“œëŠ” S3 ë²„í‚·ì„ ì‚¬ìš©í•˜ë©°, ê²½ë¡œëŠ” `site_slug/íŒŒì¼ëª…` í˜•ì‹ìœ¼ë¡œ ì €ì¥í•œë‹¤.

---

## 8. ìƒˆë¡œìš´ ì‚¬ì´íŠ¸ ì¶”ê°€ ì ˆì°¨
1. `sites/<new_site>/` ë””ë ‰í† ë¦¬ ìƒì„± (`urls.py`, `views.py`, `serializers.py`, `templates/`, `static/`)
2. `config/site_router.py`ì— ë„ë©”ì¸ ë§¤í•‘ ì¶”ê°€
3. `settings/prod.py`ì˜ `ALLOWED_HOSTS`ì— ë„ë©”ì¸ ë“±ë¡
4. Nginx/ALB ì„¤ì •ì— ìƒˆ ë„ë©”ì¸ ì—°ê²°
5. (ì„ íƒ) `SiteConfig` DBì— í•´ë‹¹ ì‚¬ì´íŠ¸ í™˜ê²½ ê°’ ì‹œë”©

---

## 9. ë„¤ì´ë° ê·œì¹™
- ëª¨ë“  ì‚¬ì´íŠ¸ë³„ slugëŠ” ì†Œë¬¸ì/ì–¸ë”ìŠ¤ì½”ì–´(`_`)ë¡œ ì •ì˜ (`admin_api`, `public_api`)
- DB í…Œì´ë¸”ì˜ `site_id`ëŠ” slugì™€ ë™ì¼í•˜ê²Œ ìœ ì§€
- API ì—”ë“œí¬ì¸íŠ¸ ë²„ì €ë‹ì€ `/api/v1/` í˜•íƒœë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•œë‹¤.

---

## 10. ë‚ ì§œ/ì‹œê°„ í˜•ì‹ ê·œì¹™
- **ëª¨ë“  ë‚ ì§œ/ì‹œê°„ í•„ë“œëŠ” "ë…„-ì›”-ì¼ ì‹œ:ë¶„:ì´ˆ" í˜•ì‹ìœ¼ë¡œ í†µì¼**
- **ë°±ì—”ë“œ**: ISO í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ë˜, API ì‘ë‹µ ì‹œ "YYYY-MM-DD HH:MM:SS" í˜•ì‹ìœ¼ë¡œ ë³€í™˜
- **í”„ë¡ íŠ¸ì—”ë“œ**: ë°›ì€ ë‚ ì§œ/ì‹œê°„ì„ "YYYY-MM-DD HH:MM:SS" í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
- **ì˜ˆì‹œ**: `2019-07-08 12:36:15`
- **êµ¬í˜„ ë°©ë²•**:
  - Django: `DateTimeField` ì‚¬ìš©, `strftime('%Y-%m-%d %H:%M:%S')`ë¡œ í¬ë§·íŒ…
  - JavaScript: `new Date().toLocaleString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' })` ì‚¬ìš©

---

## 11. í˜ì´ì§€ë„¤ì´ì…˜ ê·œì¹™ (ì¤‘ìš”!)

### **ê¸°ë³¸ ì›ì¹™**
- **ëª¨ë“  ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ APIëŠ” ë°˜ë“œì‹œ í˜ì´ì§€ë„¤ì´ì…˜ì„ ì§€ì›í•´ì•¼ í•œë‹¤.**
- **í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `page`ì™€ `pageSize` íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•œë‹¤.**
- **ë°±ì—”ë“œì—ì„œ í˜ì´ì§€ë„¤ì´ì…˜ì„ ì²˜ë¦¬í•˜ê³ , í”„ë¡ íŠ¸ì—”ë“œì— í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ë¥¼ ì œê³µí•œë‹¤.**

### **íŒŒë¼ë¯¸í„° ê·œì¹™**
```python
# í•„ìˆ˜ íŒŒë¼ë¯¸í„°
page = request.query_params.get('page', 1)        # í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸ê°’: 1)
page_size = request.query_params.get('pageSize', 20)  # í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜ (ê¸°ë³¸ê°’: 20)

# íŒŒë¼ë¯¸í„° ìœ íš¨ì„± ê²€ì‚¬
try:
    page_size = int(page_size)
    if page_size < 1 or page_size > 100:  # ìµœëŒ€ 100ê°œë¡œ ì œí•œ
        page_size = 20
except ValueError:
    page_size = 20

try:
    page = int(page)
    if page < 1:
        page = 1
except ValueError:
    page = 1
```

### **Django í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„**
```python
from django.core.paginator import Paginator, EmptyPage, PageNotAnInteger

def list(self, request, *args, **kwargs):
    """ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜ í¬í•¨)"""
    try:
        # í˜ì´ì§€ë„¤ì´ì…˜ íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
        page = request.query_params.get('page', 1)
        page_size = request.query_params.get('pageSize', 20)
        
        # íŒŒë¼ë¯¸í„° ìœ íš¨ì„± ê²€ì‚¬
        try:
            page_size = int(page_size)
            if page_size < 1 or page_size > 100:
                page_size = 20
        except ValueError:
            page_size = 20
        
        try:
            page = int(page)
            if page < 1:
                page = 1
        except ValueError:
            page = 1
        
        # ì¿¼ë¦¬ì…‹ ê°€ì ¸ì˜¤ê¸°
        queryset = self.get_queryset()
        total_count = queryset.count()
        
        # í˜ì´ì§€ë„¤ì´ì…˜ ì²˜ë¦¬
        paginator = Paginator(queryset, page_size)
        
        try:
            page_obj = paginator.page(page)
        except PageNotAnInteger:
            page_obj = paginator.page(1)
            page = 1
        except EmptyPage:
            page_obj = paginator.page(paginator.num_pages)
            page = paginator.num_pages
        
        # ì‹œë¦¬ì–¼ë¼ì´ì €ë¡œ ë°ì´í„° ë³€í™˜
        serializer = self.get_serializer(page_obj, many=True)
        
        # í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ êµ¬ì„±
        pagination_info = {
            'current_page': page,
            'page_size': page_size,
            'total_count': total_count,
            'total_pages': paginator.num_pages,
            'has_next': page_obj.has_next(),
            'has_previous': page_obj.has_previous(),
            'next_page': page_obj.next_page_number() if page_obj.has_next() else None,
            'previous_page': page_obj.previous_page_number() if page_obj.has_previous() else None,
            'start_index': page_obj.start_index(),
            'end_index': page_obj.end_index()
        }
        
        # ì‘ë‹µ ë°ì´í„° êµ¬ì„±
        response_data = create_success_response({
            'items': serializer.data,  # ì‹¤ì œ ë°ì´í„°
            'pagination': pagination_info  # í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´
        })
        return Response(response_data)
        
    except Exception as e:
        response_data = create_error_response(f'ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}')
        return Response(response_data, status=status.HTTP_500_INTERNAL_SERVER_ERROR)
```

### **API ì‘ë‹µ í˜•ì‹**
```json
{
  "indeAPIResponse": {
    "ErrorCode": "00",
    "Message": "ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
    "Result": {
      "items": [
        // ì‹¤ì œ ë°ì´í„° í•­ëª©ë“¤
      ],
      "pagination": {
        "current_page": 1,
        "page_size": 20,
        "total_count": 150,
        "total_pages": 8,
        "has_next": true,
        "has_previous": false,
        "next_page": 2,
        "previous_page": null,
        "start_index": 1,
        "end_index": 20
      }
    }
  }
}
```

### **í”„ë¡ íŠ¸ì—”ë“œ ì‚¬ìš© ì˜ˆì‹œ**
```javascript
// React/JavaScript ì˜ˆì‹œ
const fetchItems = async (page = 1, pageSize = 20) => {
  try {
    const response = await fetch(
      `/api/admin/items/?page=${page}&pageSize=${pageSize}`,
      {
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      }
    );
    
    const data = await response.json();
    
    if (data.IndeAPIResponse.ErrorCode === '00') {
      const { items, pagination } = data.IndeAPIResponse.Result;
      
      // ë°ì´í„° ì²˜ë¦¬
      setItems(items);
      setPagination(pagination);
      
      // í˜ì´ì§€ë„¤ì´ì…˜ UI ì—…ë°ì´íŠ¸
      setCurrentPage(pagination.current_page);
      setTotalPages(pagination.total_pages);
      setTotalCount(pagination.total_count);
    }
  } catch (error) {
    console.error('ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
  }
};

// í˜ì´ì§€ ë³€ê²½ ì‹œ
const handlePageChange = (newPage) => {
  fetchItems(newPage, pagination.page_size);
};

// í˜ì´ì§€ í¬ê¸° ë³€ê²½ ì‹œ
const handlePageSizeChange = (newPageSize) => {
  fetchItems(1, newPageSize); // ì²« í˜ì´ì§€ë¶€í„° ì‹œì‘
};
```

### **í˜ì´ì§€ë„¤ì´ì…˜ ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ**
```jsx
const PaginationComponent = ({ pagination, onPageChange, onPageSizeChange }) => {
  const { current_page, total_pages, page_size, total_count } = pagination;
  
  return (
    <div className="pagination">
      <div className="pagination-info">
        ì´ {total_count}ê°œ í•­ëª©, {current_page} / {total_pages} í˜ì´ì§€
      </div>
      
      <div className="pagination-controls">
        <button 
          onClick={() => onPageChange(current_page - 1)}
          disabled={current_page <= 1}
        >
          ì´ì „
        </button>
        
        <span>{current_page}</span>
        
        <button 
          onClick={() => onPageChange(current_page + 1)}
          disabled={current_page >= total_pages}
        >
          ë‹¤ìŒ
        </button>
      </div>
      
      <select 
        value={page_size} 
        onChange={(e) => onPageSizeChange(parseInt(e.target.value))}
      >
        <option value={10}>10ê°œì”©</option>
        <option value={20}>20ê°œì”©</option>
        <option value={50}>50ê°œì”©</option>
        <option value={100}>100ê°œì”©</option>
      </select>
    </div>
  );
};
```

### **ì ìš© ëŒ€ìƒ API**
- **ê¸°ë³¸ CRUD**: `list()` ë©”ì„œë“œ (GET /api/admin/items/)
- **ì»¤ìŠ¤í…€ ì•¡ì…˜**: `pending_items()`, `recent_items()` ë“± ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ ì•¡ì…˜
- **ê²€ìƒ‰ ê²°ê³¼**: ê²€ìƒ‰ APIì˜ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸
- **í•„í„°ë§ ê²°ê³¼**: í•„í„°ë§ëœ ë°ì´í„° ë¦¬ìŠ¤íŠ¸

### **í˜ì´ì§€ë„¤ì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] `page`ì™€ `pageSize` íŒŒë¼ë¯¸í„° ë°›ê¸°
- [ ] íŒŒë¼ë¯¸í„° ìœ íš¨ì„± ê²€ì‚¬ (1~100 ë²”ìœ„)
- [ ] Django `Paginator` ì‚¬ìš©
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ í¬í•¨í•˜ì—¬ ì‘ë‹µ
- [ ] ì˜¤ë¥˜ ì²˜ë¦¬ (PageNotAnInteger, EmptyPage)
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í˜ì´ì§€ë„¤ì´ì…˜ UI êµ¬í˜„

### **PHP ë¡œì§ ë³€í™˜ ê·œì¹™**
- `$pageByRecord` â†’ `pageSize` (í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜)
- `$pageNo` â†’ `page` (í˜ì´ì§€ ë²ˆí˜¸)
- Django í”„ë ˆì„ì›Œí¬ì˜ ê¸°ë³¸ í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ì²˜ë¦¬

---

## 12. ì°¸ê³ 
- **ì•„í‚¤í…ì²˜ ëª…ì¹­**: ë©€í‹°ì‚¬ì´íŠ¸(Multi-Site) ì•„í‚¤í…ì²˜, ë„ë©”ì¸ ê¸°ë°˜ ë¼ìš°íŒ… êµ¬ì¡°
- **í´ë” êµ¬ì¡° ëª…ì¹­**: ì‚¬ì´íŠ¸ ëª¨ë“ˆ ë¶„ë¦¬(Site-specific modular structure)

---

## 13. ëª¨ë“ˆ Import ê·œì¹™ ë° ë¬¸ì œ í•´ê²° ê°€ì´ë“œ (ì¤‘ìš”!)

### âš ï¸ **ëª¨ë“ˆ Import ë¬¸ì œ ë°©ì§€ ê·œì¹™**

#### **1. ê¸°ë³¸ ì›ì¹™**
- **`IndeBackend` í”„ë¡œì íŠ¸ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤**
- **ë‹¤ë¥¸ í”„ë¡œì íŠ¸(`IndeWebBackend`)ì˜ ëª¨ë“ˆì„ ì§ì ‘ importí•˜ì§€ ì•ŠëŠ”ë‹¤**
- **í•„ìš”í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ëŠ” `core.utils`ì— êµ¬í˜„í•œë‹¤**

#### **2. ê¸ˆì§€ì‚¬í•­**
# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• - ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ êµ¬í˜„
# core/utils.pyì— í•„ìš”í•œ í•¨ìˆ˜ë“¤ì„ ëª¨ë‘ êµ¬í˜„
```

#### **4. ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ëª©ë¡**
`core/utils.py`ì— ë‹¤ìŒ í•¨ìˆ˜ë“¤ì´ êµ¬í˜„ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:

```python
# API ì‘ë‹µ ìƒì„± í•¨ìˆ˜
def create_api_response(success, error_code, message, result)
def create_success_response(result=None, message='ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.')
def create_error_response(message='ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', error_code='99')

# ì‹œí€€ìŠ¤ ì½”ë“œ ìƒì„±
def generate_seq_code(table_name)

# ê¸°íƒ€ ê³µí†µ ìœ í‹¸ë¦¬í‹°
class CommonUtils:
    @staticmethod
    def generate_hash(data)
    @staticmethod
    def validate_email(email)
    @staticmethod
    def validate_phone(phone)
    # ... ê¸°íƒ€ ë©”ì„œë“œë“¤
```

#### **5. ë¬¸ì œ ë°œìƒ ì‹œ í•´ê²° ì ˆì°¨**

##### **ë¬¸ì œ ìƒí™©**
```
ModuleNotFoundError: No module named '_IndeWebAPI'
```


#### **7. ê°œë°œ ì‹œ ì£¼ì˜ì‚¬í•­**
- **ìƒˆë¡œìš´ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ê°€ í•„ìš”í•˜ë©´ `core/utils.py`ì— ì¶”ê°€**
- **í”„ë¡œì íŠ¸ ê°„ ì˜ì¡´ì„±ì€ ìµœì†Œí™”í•˜ê³  ë…ë¦½ì„± ìœ ì§€**
#### **8. Django Serializer ê°œë°œ ê·œì¹™**

##### **âš ï¸ source ì†ì„± ì¤‘ë³µ ê¸ˆì§€**
```python
# âŒ ì˜ëª»ëœ ë°©ë²• - sourceê°€ í•„ë“œëª…ê³¼ ë™ì¼í•˜ë©´ ì¤‘ë³µ
formatted_license_date = serializers.CharField(source='formatted_license_date', read_only=True)
total_amount_with_vat = serializers.IntegerField(source='total_amount_with_vat', read_only=True)

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• - source ì œê±°
formatted_license_date = serializers.CharField(read_only=True)
total_amount_with_vat = serializers.IntegerField(read_only=True)

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• - ë‹¤ë¥¸ ì´ë¦„ì˜ í•„ë“œì— source ì‚¬ìš©
license_type_display = serializers.CharField(source='get_license_type_display_name', read_only=True)
```


### ğŸ—„ï¸ **ë°ì´í„°ë² ì´ìŠ¤**
- **ë§ˆë¦¬ì•„DB(MySQL)** ì‚¬ìš©
- í™˜ê²½ë³„ `.env` íŒŒì¼ë¡œ ì„¤ì • ê´€ë¦¬
- `core` ì•±ì˜ ëª¨ë“  ëª¨ë¸ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ


> âš ï¸ **TOP PRIORITY â€” DB & Migration Policy**
>
> - **DB ìƒì„±/ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ ì „ì ìœ¼ë¡œ ì‚¬ìš©ì(ìš´ì˜ì/DBA)ê°€ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜í–‰í•œë‹¤.**
> - **ì–´ë– í•œ í™˜ê²½ì—ì„œë„ `manage.py migrate`ë¥¼ ìë™/ë¬´ì˜ì‹ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.**
> - CI/CD ìŠ¤í¬ë¦½íŠ¸, ë°°í¬ ìŠ¤í¬ë¦½íŠ¸, í—¬ìŠ¤ì²´í¬, ìµœì´ˆ ë¶€íŒ… í›… ë“±ì— **`migrate` í˜¸ì¶œì„ ì ˆëŒ€ ë„£ì§€ ì•ŠëŠ”ë‹¤.**
> - ê°œë°œ ë‹¨ê³„ì—ì„œë„ ë§ˆì´ê·¸ë ˆì´ì…˜ **ì ìš©ì€ ê¸ˆì§€**(ë‹¨, ìŠ¤í‚¤ë§ˆ ì´ë ¥ ê´€ë¦¬ë¥¼ ìœ„í•´ `makemigrations` íŒŒì¼ ìƒì„±ì€ í—ˆìš© ê°€ëŠ¥).
> - ìŠ¤í‚¤ë§ˆ ì ìš©ì´ í•„ìš”í•˜ë©´, **DBAê°€ ìŠ¹ì¸í•œ SQL** ë˜ëŠ” ìˆ˜ë™ ì ˆì°¨ë¡œ ë°˜ì˜í•œë‹¤.
>
> #### ìš´ì˜ ì•ˆì „ì¥ì¹˜(ê¶Œì¥)
> - í™˜ê²½ë³€ìˆ˜ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì°¨ë‹¨í•œë‹¤:
>   - `DISALLOW_MIGRATE=1` ì¼ ë•Œ `migrate` ì‹¤í–‰ ì‹œ ì¢…ë£Œ.
> - `config/settings/base.py` ìƒë‹¨ì— ë‹¤ìŒì„ ë‘”ë‹¤:
>   ```python
>   # ë³´í˜¸ì¥ì¹˜: ì´ í™˜ê²½ì—ì„œ migrate ê¸ˆì§€
>   import os, sys
>   if os.getenv("DISALLOW_MIGRATE", "0") == "1" and "migrate" in sys.argv:
>       raise SystemExit("Migrations are disabled in this environment.")
>   ```
> - ë°°í¬ìš© systemd/CI ìŠ¤í¬ë¦½íŠ¸ì— `migrate`ê°€ í¬í•¨ë˜ì§€ ì•Šë„ë¡ ì ê²€í•œë‹¤.
>   - ì˜ˆ: `grep -R "manage.py migrate" /opt/deploy && echo "âŒ ì œê±°í•˜ì„¸ìš”"`
>
> #### íŒ€ ê·œì¹™
> - ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼(`*/migrations/*.py`)ì€ **ìŠ¤í‚¤ë§ˆ ì´ë ¥**ìœ¼ë¡œì„œ ì»¤ë°‹í•  ìˆ˜ ìˆìœ¼ë‚˜, **ì ìš©ì€ DBA ìŠ¹ì¸ í›„ì—ë§Œ**.
> - ìë™ ì‹¤í–‰ ê¸ˆì§€: "ì•± ì‹œì‘ ì‹œ ìë™ migrate", "í…ŒìŠ¤íŠ¸ ì „ ìë™ migrate" ê°™ì€ íŒ¨í„´ì€ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
> - ìŠ¤í‚¤ë§ˆ ë³€ê²½ ìš”ì²­(PR)ì—ëŠ” **ë³€ê²½ ìš”ì•½ + ìˆ˜ë™ ë°˜ì˜ ê°€ì´ë“œ(SQL ë˜ëŠ” ë‹¨ê³„ë³„ ì§€ì¹¨)**ë¥¼ ë°˜ë“œì‹œ í¬í•¨í•œë‹¤.


## ê³µí†µ ìœ í‹¸(utilities)
- ê³µí†µ í•¨ìˆ˜ëŠ” music/utils.py ì •ì˜
- ì˜ˆ: get_s3_file_from_upload(contractType, sid, fileType) â†’ S3 presigned URL
- ê³µí†µí•¨ìˆ˜ ë‚´ë¶€ì—ì„œëŠ” ëª¨ë¸ì˜ ìˆœí™˜ì°¸ì¡° ì˜¤ë¥˜ê°€ ë‚ ìˆ˜ìˆìœ¼ë‹ˆ í•¨ìˆ˜ë‚´ë¶€ì—ì„œ ëª¨ë¸ì„ importí• ê²ƒ 

## ì˜ˆì™¸ ì²˜ë¦¬
- ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ try/except ì²˜ë¦¬í•  ê²ƒ
- ì˜ˆì™¸ëŠ” Exception ëŒ€ì‹  ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ ì˜ˆì™¸ë¡œ ì²˜ë¦¬
- ë·°ì—ì„œëŠ” Response({error: ...}, status=400 or 500) í˜•ì‹ìœ¼ë¡œ ì¼ê´€ì„± ìˆê²Œ ë°˜í™˜

- íŠ¹ë³„í•œ ì´ì•¼ê¸°ê°€ ì—†ìœ¼ë©´ ë¬´ì¡°ê±´ ê¶Œí•œ ì²´í¬ëŠ” í•„ìˆ˜ í•­ëª©ìœ¼ë¡œ ì²˜ë¦¬

## íŠ¸ëœì­ì…˜
-- ë³µí•© DB ì‘ì—…ì€ @transaction.atomic ë°ì½”ë ˆì´í„° ì‚¬ìš©

## ì„œë¹„ìŠ¤ í•¨ìˆ˜ ëª…ëª… ê·œì¹™
ê¸°ëŠ¥	í•¨ìˆ˜ ì´ë¦„ ì˜ˆì‹œ
ì¡°íšŒ	get_contract_detail, get_user_contracts
ìƒì„±	create_contract, create_file_upload
ìˆ˜ì •	update_contract_state, update_user_info
ì‚­ì œ	delete_contract, delete_user_token


## ë¡œì§êµ¬ì„±ì‹œ ì˜ˆì œë¡œ php ë¡œì§ì´ ìˆìœ¼ë©´
- $pageByRecord -> page_size
- $pageNo -> page
- ì¥ê³  í”„ë ˆì„ì›ì˜ ê¸°ë³¸ í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ì²˜ë¦¬í• ê²ƒ 


## ëª¨ë“  ì†ŒìŠ¤ë¥¼ ìƒì„±í• ë•ŒëŠ” ê°€ëŠ¥í•œí•œ ì£¼ì„ì„ ë‹¬ì•„ì¤„ê²ƒ íŠ¹íˆ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì„¤ëª…ì´ í•„ìš”í•œ ë¶€ë¶„ì€ ê¼­ ë‹¬ê²ƒ

## ë””ë¹„ ì²˜ë¦¬
- ë””ë¹„ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ì²˜ë¦¬ í•˜ì§€ë§ê²ƒ 
- ë§ˆì´ê·¸ë ˆì´ì…˜ì— íŒŒì¼ë„ ìƒì„± í•˜ì§€ë§ê²ƒ 
- í•„ìš”ì‹œ ë””ë¹„ëŠ” ì‚¬ìš©ìê°€ ì§ì ‘ ê´€ë¦¬, ì•ˆë‚´ë§Œ í• ê²ƒ

## í…Œì´ë¸”ëª… ê·œì¹™
- settlementë¡œ ì‹œì‘í•˜ëŠ” í…Œì´ë¸”ëª…ì€ ë°˜ë“œì‹œ ì²«ê¸€ì 'S'ë¥¼ ëŒ€ë¬¸ìë¡œ ì²˜ë¦¬
- ì˜ˆ: settlementNotice â†’ SettlementNotice
- ì˜ˆ: settlementNoticeTrans â†’ SettlementNoticeTrans
- ì˜ˆ: settlementJungsanFinal â†’ SettlementJungsanFinal
- ì˜ˆ: settlementJungsanMaster â†’ SettlementJungsanMaster


## íŒŒì¼ëª…ì„ ë§Œë“¤ë•Œ
-- ê¸°ë³¸ì ìœ¼ë¡œ ì¥ê³ ê°€ ê¸°ë³¸ ì„¤ì •ì„ í•˜ê³  ìˆëŠ”ëŒ€ë¡œ ìƒì„±
-- ì§€ì‹œí•œ ë‚´ìš©ì´ ì¥ê³ ì˜ ê¸°ë³¸ì„¤ì •ê³¼ í‹€ë¦´ê²½ìš°ëŠ” ë¬¼ì–´ë³¼ê²ƒ 

## API response Data í˜•ì‹
-- from _IndeWebAPI.utils import  create_success_response, create_error_responsecreate_custom_error_response

-- í•­ìƒ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì¨ì„œ ì²˜ë¦¬í• ê²ƒ 
-- ì •ìƒë°ì´í„°ë“  ì˜¤ë¥˜ë°ì´í„°ë“  í•­ìƒ ì´ í•¨ìˆ˜ë¥¼ì¨ì¨ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ê°ì‹¸ê³  ë³´ë‚¼ ê²ƒ 
-- ì˜ˆì œ 
    try{
            return create_success_response({
                'data': data
            })
        
    except Exception as e:
        error_message = str(e)
        # ì¤‘ë³µ ì‹ ì²­ ì˜¤ë¥˜ì¸ ê²½ìš° ì»¤ìŠ¤í…€ ì˜¤ë¥˜ ì½”ë“œ ì‚¬ìš©
        if 'ì´ë¯¸ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤' in error_message:
            response = create_custom_error_response('77', error_message)
            return response
        else:
            return create_error_response(f'ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {error_message}')

## âš ï¸ Django REST Framework API ì‘ë‹µ ì²˜ë¦¬ ê·œì¹™ (ì¤‘ìš”!)

### âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
Django REST Frameworkì˜ APIViewì—ì„œëŠ” **ë°˜ë“œì‹œ Response ê°ì²´ë¥¼ ë°˜í™˜**í•´ì•¼ í•©ë‹ˆë‹¤.

```python
# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
from rest_framework.response import Response
from rest_framework import status
from _IndeWebAPI.utils import create_success_response, create_error_response

class MyAPIView(APIView):
    def post(self, request):
        try:
            # ì„œë¹„ìŠ¤ ë ˆì´ì–´ í˜¸ì¶œ
            data = my_service_function(request.user, request.data)
            
            # ì„±ê³µ ì‘ë‹µ (Response ê°ì²´ë¡œ ê°ì‹¸ê¸°)
            response_data = create_success_response({
                'data': data
            })
            return Response(response_data)
            
        except Exception as e:
            error_message = str(e)
            # ì˜¤ë¥˜ ì‘ë‹µ (Response ê°ì²´ë¡œ ê°ì‹¸ê¸°)
            response_data = create_error_response(error_message, error_code='99')
            return Response(response_data, status=status.HTTP_400_BAD_REQUEST)
```

### âŒ ì˜ëª»ëœ ë°©ë²•
```python
# âŒ ì˜ëª»ëœ ë°©ë²• - dictë¥¼ ì§ì ‘ ë°˜í™˜í•˜ë©´ AssertionError ë°œìƒ
def post(self, request):
    try:
        data = my_service_function(request.user, request.data)
        return create_success_response({'data': data})  # dict ë°˜í™˜ - ì˜¤ë¥˜!
    except Exception as e:
        return create_error_response(str(e))  # dict ë°˜í™˜ - ì˜¤ë¥˜!
```

### âœ… ìƒíƒœ ì½”ë“œë³„ ì‘ë‹µ íŒ¨í„´
```python
# ê¶Œí•œ ì˜¤ë¥˜ (401)
response_data = create_error_response('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', error_code='99')
return Response(response_data, status=status.HTTP_401_UNAUTHORIZED)

# íŒŒë¼ë¯¸í„° ì˜¤ë¥˜ (400)
response_data = create_error_response('í•„ìˆ˜ íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', error_code='99')
return Response(response_data, status=status.HTTP_400_BAD_REQUEST)

# ì„œë²„ ì˜¤ë¥˜ (500)
response_data = create_error_response('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', error_code='99')
return Response(response_data, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

# ì„±ê³µ ì‘ë‹µ (200)
response_data = create_success_response({'data': result_data})
return Response(response_data)
```

### âš ï¸ ì£¼ì˜ì‚¬í•­
- `create_success_response()`, `create_error_response()` í•¨ìˆ˜ë“¤ì€ **dictë¥¼ ë°˜í™˜**í•©ë‹ˆë‹¤
- Django REST Frameworkì˜ APIViewëŠ” **Response ê°ì²´ë¥¼ ê¸°ëŒ€**í•©ë‹ˆë‹¤
- ë”°ë¼ì„œ ë°˜ë“œì‹œ `Response()`ë¡œ ê°ì‹¸ì„œ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤
- ì´ ê·œì¹™ì„ ìœ„ë°˜í•˜ë©´ `AssertionError: Expected a Response, HttpResponse or StreamingHttpResponse` ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤

---

## ğŸš« API ì‘ë‹µ ì¤‘ë³µ ëìŠ¤ ë°©ì§€ ê·œì¹™ (ì¤‘ìš”!)

### âš ï¸ ë¬¸ì œ ìƒí™©
Inde BackendëŠ” `IndeJSONRenderer`ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  API ì‘ë‹µì„ ìë™ìœ¼ë¡œ `IndeAPIResponse` í˜•ì‹ìœ¼ë¡œ ê°ìŒ‰ë‹ˆë‹¤.

**ì¤‘ë³µ ëìŠ¤ ë°œìƒ ì˜ˆì‹œ:**
```python
# âŒ ì˜ëª»ëœ ë°©ë²• - ì¤‘ë³µ ëìŠ¤ ë°œìƒ
class MemberListView(APIView):
    def get(self, request):
        data = {"members": [...], "pagination": {...}}
        
        # ë·°ì—ì„œ í•œë²ˆ ê°ì‹¸ê¸°
        response_data = {
            "IndeAPIResponse": {
                "ErrorCode": "00",
                "Message": "ì„±ê³µ",
                "Result": data
            }
        }
        
        # ë Œë”ëŸ¬ì—ì„œ ë˜ í•œë²ˆ ê°ì‹¸ê¸° â†’ ì¤‘ë³µ ëìŠ¤!
        return Response(response_data)
```

**ê²°ê³¼ (ì˜ëª»ëœ ì‘ë‹µ):**
```json
{
    "IndeAPIResponse": {
        "ErrorCode": "00",
        "Message": "ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "Result": {
            "IndeAPIResponse": {  // â† ì¤‘ë³µ!
                "ErrorCode": "00",
                "Message": "ì„±ê³µ",
                "Result": {
                    "members": [...],
                    "pagination": {...}
                }
            }
        }
    }
}
```

### âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
ë·°ì—ì„œëŠ” **ë°ì´í„°ë§Œ ë°˜í™˜**í•˜ê³ , ë Œë”ëŸ¬ê°€ ìë™ìœ¼ë¡œ `IndeAPIResponse` í˜•ì‹ì„ ì ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤.

```python
# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• - ì¤‘ë³µ ëìŠ¤ ë°©ì§€
class MemberListView(APIView):
    def get(self, request):
        try:
            # ì„œë¹„ìŠ¤ ë ˆì´ì–´ í˜¸ì¶œ
            result = AdminMembershipService.get_all_members(page=1, page_size=20)
            
            if result['success']:
                # ë°ì´í„°ë§Œ ë°˜í™˜ (ë Œë”ëŸ¬ê°€ ìë™ìœ¼ë¡œ ê°ìŒˆ)
                return Response({
                    "members": result['data']['members'],
                    "pagination": result['data']['pagination']
                }, status=status.HTTP_200_OK)
            else:
                # ì˜¤ë¥˜ ë°ì´í„°ë§Œ ë°˜í™˜
                return Response({
                    "error": result['error']
                }, status=status.HTTP_400_BAD_REQUEST)
                
        except Exception as e:
            # ì˜¤ë¥˜ ë°ì´í„°ë§Œ ë°˜í™˜
            return Response({
                "error": f"ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}"
            }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)
```

**ê²°ê³¼ (ì˜¬ë°”ë¥¸ ì‘ë‹µ):**
```json
{
    "IndeAPIResponse": {
        "ErrorCode": "00",
        "Message": "ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "Result": {
            "members": [...],
            "pagination": {...}
        }
    }
}
```

### ğŸ”§ ë Œë”ëŸ¬ ë™ì‘ ì›ë¦¬
`IndeJSONRenderer`ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìë™ìœ¼ë¡œ ì‘ë‹µì„ ì²˜ë¦¬í•©ë‹ˆë‹¤:

1. **ì„±ê³µ ì‘ë‹µ (2xx)**: `ErrorCode: "00"`, `Message: "ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."`
2. **í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ (4xx)**: `ErrorCode: "40"`, `Message: "ìš”ì²­ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."`
3. **ì„œë²„ ì˜¤ë¥˜ (5xx)**: `ErrorCode: "50"`, `Message: "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."`

### ğŸ“‹ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë·°ì—ì„œ `IndeAPIResponse` ë˜í•‘í•˜ì§€ ì•Šê¸°
- [ ] ë°ì´í„°ë§Œ ë°˜í™˜í•˜ê¸° (ì˜ˆ: `{"members": [...], "pagination": {...}}`)
- [ ] ì˜¤ë¥˜ ì‹œì—ë„ ê°„ë‹¨í•œ êµ¬ì¡°ë¡œ ë°˜í™˜í•˜ê¸° (ì˜ˆ: `{"error": "ì˜¤ë¥˜ ë©”ì‹œì§€"}`)
- [ ] ë Œë”ëŸ¬ê°€ ìë™ìœ¼ë¡œ ê³µí†µ í˜•ì‹ì„ ì ìš©í•˜ë„ë¡ ë‘ê¸°

### ğŸš¨ ê¸ˆì§€ì‚¬í•­
- âŒ ë·°ì—ì„œ `IndeAPIResponse` ë˜í•‘
- âŒ ì¤‘ì²©ëœ ì‘ë‹µ êµ¬ì¡° ìƒì„±
- âŒ ë³µì¡í•œ ì‘ë‹µ í˜•ì‹ ì§ì ‘ êµ¬ì„±

ì´ ê·œì¹™ì„ ë”°ë¥´ë©´ ëª¨ë“  APIì—ì„œ ì¼ê´€ëœ ì‘ë‹µ í˜•ì‹ì„ ìœ ì§€í•˜ë©´ì„œ ì¤‘ë³µ ëìŠ¤ ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸš€ ë¡œì»¬ ê°œë°œ í™˜ê²½ ì„¤ì •

### **ë©€í‹°ì‚¬ì´íŠ¸ ì•„í‚¤í…ì²˜ ë¡œì»¬ í…ŒìŠ¤íŠ¸**

Inde BackendëŠ” ë©€í‹°ì‚¬ì´íŠ¸ ì•„í‚¤í…ì²˜ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, ë¡œì»¬ì—ì„œ ê° ì‚¬ì´íŠ¸ë³„ë¡œ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

#### **1. í¬íŠ¸ë³„ ì‚¬ì´íŠ¸ ì ‘ê·¼ ì„¤ì •**

```python
# config/site_router.py
SITE_MAP = {
    # í”„ë¡œë•ì…˜ ë„ë©”ì¸
    "admin_api.Inde.com": {
        "slug": "admin_api",
        "urlconf": "sites.admin_api.urls",
        "cors": ["https://admin.Inde.com"],
        "media_prefix": "admin",
    },
    "api.Inde.com": {
        "slug": "public_api", 
        "urlconf": "sites.public_api.urls",
        "cors": ["https://www.Inde.com"],
        "media_prefix": "public",
    },
    
    # ë¡œì»¬ ê°œë°œ í™˜ê²½: í¬íŠ¸ë³„ë¡œ ì‚¬ì´íŠ¸ ë¶„ë¦¬
    "localhost:8000": {"slug": "admin_api", "urlconf": "sites.admin_api.urls", "cors": ["http://localhost:3000"], "media_prefix":"local"},
    "localhost:8001": {"slug": "public_api", "urlconf": "sites.public_api.urls", "cors": ["http://localhost:3000"], "media_prefix":"local"},
}
```

#### **2. ì„œë²„ ì‹¤í–‰ ë°©ë²•**

##### **ë°©ë²• 1: ë‹¨ì¼ í¬íŠ¸ (ê¶Œì¥)**
```bash
cd IndeBackend
source venv/bin/activate
python run_single_server.py

# ë©”ë‰´ì—ì„œ ì›í•˜ëŠ” ì‚¬ì´íŠ¸ ì„ íƒ
# 1. admin_api - ê´€ë¦¬ì API (JWT ì¸ì¦)
# 2. public_api - ê³µê°œ API
# 3. score_web - ìŠ¤ì½”ì–´ ì›¹ API  
# 4. score_app - ìŠ¤ì½”ì–´ ì•± API
```

##### **ë°©ë²• 2: ë©€í‹° í¬íŠ¸ (ë™ì‹œ ì‹¤í–‰)**
```bash
cd IndeBackend
source venv/bin/activate
python run_local_servers.py

# ëª¨ë“  ì‚¬ì´íŠ¸ê°€ ë™ì‹œì— ì‹¤í–‰ë¨
# admin_api:8000, public_api:8001, score_web:8002, score_app:8003
```

#### **3. ë¡œì»¬ í…ŒìŠ¤íŠ¸ URL**

```bash
# ğŸŒ admin_api (ê´€ë¦¬ì API) - í¬íŠ¸ 8000
http://localhost:8000/ping/           # ìƒíƒœ í™•ì¸
http://localhost:8000/login/          # ë¡œê·¸ì¸ (POST)
http://localhost:8000/dashboard/      # ëŒ€ì‹œë³´ë“œ (JWT ì¸ì¦ í•„ìš”)
http://localhost:8000/members/        # ë©¤ë²„ ëª©ë¡ (JWT ì¸ì¦ í•„ìš”)

# ğŸŒ public_api (ê³µê°œ API) - í¬íŠ¸ 8001  
http://localhost:8001/ping/           # ìƒíƒœ í™•ì¸

# ğŸŒ score_web (ìŠ¤ì½”ì–´ ì›¹ API) - í¬íŠ¸ 8002
http://localhost:8002/ping/           # ìƒíƒœ í™•ì¸

# ğŸŒ score_app (ìŠ¤ì½”ì–´ ì•± API) - í¬íŠ¸ 8003
http://localhost:8003/ping/           # ìƒíƒœ í™•ì¸
```

#### **4. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©ë²•**

```bash
# admin_api JWT ì¸ì¦ í…ŒìŠ¤íŠ¸
python test_admin_api.py

# í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„±
python create_test_admin.py
```

#### **5. JWT ì¸ì¦ ìƒì„¸ ê°€ì´ë“œ**

##### **JWT í† í° êµ¬ì¡° ë° ì¸ì¦ íë¦„**

```python
# JWT í† í° ìƒì„± (utils.py)
def create_admin_jwt_tokens(user: AdminMemberShip):
    access_payload = {
        'user_id': user.memberShipSid,      # memberShipSid ì‚¬ìš©
        'username': user.memberShipId,
        'email': user.memberShipEmail,
        'name': user.memberShipName,
        'level': user.memberShipLevel,
        'is_admin': user.is_admin,
        'exp': access_expiration,          # 15ë¶„ ë§Œë£Œ
        'iat': datetime.utcnow(),
        'site': 'admin_api',
        'token_type': 'access',
        'token_version': token_version
    }
    
    refresh_payload = {
        'user_id': user.memberShipSid,      # memberShipSid ì‚¬ìš©
        'username': user.memberShipId,
        'exp': refresh_expiration,         # 7ì¼ ë§Œë£Œ
        'iat': datetime.utcnow(),
        'site': 'admin_api',
        'token_type': 'refresh',
        'token_version': token_version
    }
```

##### **JWT ì¸ì¦ í´ë˜ìŠ¤ ì„¤ì •**

```python
# views.pyì—ì„œ JWT ì¸ì¦ ì‚¬ìš©
from sites.admin_api.authentication import AdminJWTAuthentication

class SysCodeManagerViewSet(viewsets.ModelViewSet):
    authentication_classes = [AdminJWTAuthentication]  # ë¬¸ìì—´ì´ ì•„ë‹Œ í´ë˜ìŠ¤ ê°ì²´
    permission_classes = [IsAuthenticated]
    
    # ... ë‚˜ë¨¸ì§€ ì½”ë“œ
```

##### **JWT í† í° ì‚¬ìš©ë²•**

```bash
# 1. ë¡œê·¸ì¸í•˜ì—¬ í† í° ë°›ê¸°
curl -X POST http://localhost:8000/api/admin/login/ \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'

# ì‘ë‹µ ì˜ˆì‹œ:
# {
#   "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
#   "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
# }

# 2. Access Tokenìœ¼ë¡œ API í˜¸ì¶œ
curl -X GET http://localhost:8000/api/admin/systemmanage/syscode/ \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN_HERE"
```

##### **JWT ì¸ì¦ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ**

###### **ë¬¸ì œ 1: "User not found" ì˜¤ë¥˜**
```python
# âŒ ì˜ëª»ëœ ì„¤ì •
authentication_classes = ['sites.admin_api.authentication.AdminJWTAuthentication']  # ë¬¸ìì—´

# âœ… ì˜¬ë°”ë¥¸ ì„¤ì •  
authentication_classes = [AdminJWTAuthentication]  # í´ë˜ìŠ¤ ê°ì²´
from sites.admin_api.authentication import AdminJWTAuthentication
```

###### **ë¬¸ì œ 2: JWT í† í°ê³¼ ì‚¬ìš©ì ID ë¶ˆì¼ì¹˜**
```python
# âŒ ì˜ëª»ëœ ì¸ì¦ ë¡œì§
user = AdminMemberShip.objects.get(memberShipId=user_id)  # memberShipIdë¡œ ê²€ìƒ‰

# âœ… ì˜¬ë°”ë¥¸ ì¸ì¦ ë¡œì§
user = AdminMemberShip.objects.get(memberShipSid=user_id)   # memberShipSidë¡œ ê²€ìƒ‰

# ì´ìœ : JWT í† í°ì—ëŠ” memberShipSidê°€ ì €ì¥ë˜ë¯€ë¡œ, 
# ì¸ì¦ ì‹œì—ë„ memberShipSidë¡œ ê²€ìƒ‰í•´ì•¼ í•¨
```

###### **ë¬¸ì œ 3: JWT í† í° ë§Œë£Œ**
```bash
# í† í° ê°±ì‹ 
curl -X POST http://localhost:8000/api/admin/refresh/ \
  -H "Content-Type: application/json" \
  -d '{
    "refresh_token": "YOUR_REFRESH_TOKEN_HERE"
  }'
```

##### **JWT ë³´ì•ˆ ì„¤ì •**

```python
# settings/base.py
JWT_SECRET_KEY = env("JWT_SECRET_KEY", default=SECRET_KEY)
JWT_ALGORITHM = "HS256"
JWT_EXPIRATION_DELTA = 24 * 60 * 60  # 24ì‹œê°„

# í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (Redis ì‚¬ìš©)
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://127.0.0.1:6379/1',
    }
}
```

##### **JWT ì¸ì¦ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸**

- [ ] `authentication_classes`ì— í´ë˜ìŠ¤ ê°ì²´ ì‚¬ìš© (ë¬¸ìì—´ ì•„ë‹˜)
- [ ] JWT í† í°ì˜ `user_id`ì™€ `AdminMemberShip.memberShipId` ì¼ì¹˜
- [ ] `Authorization: Bearer {token}` í—¤ë” í˜•ì‹ ì‚¬ìš©
- [ ] í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸ (Access: 15ë¶„, Refresh: 7ì¼)
- [ ] Redis ì—°ê²° ìƒíƒœ í™•ì¸ (í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ìš©)

#### **6. ë¡œì»¬ ê°œë°œ ì‹œ ì£¼ì˜ì‚¬í•­**

- **í¬íŠ¸ ì¶©ëŒ ë°©ì§€**: ê° ì‚¬ì´íŠ¸ëŠ” ê³ ìœ í•œ í¬íŠ¸ ì‚¬ìš©
- **í™˜ê²½ë³€ìˆ˜**: `DJANGO_SETTINGS_MODULE=config.settings.local` ì„¤ì •
- **ë°ì´í„°ë² ì´ìŠ¤**: ë¡œì»¬ MariaDB ì—°ê²° í™•ì¸
- **CORS ì„¤ì •**: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì„œë²„ì™€ì˜ í†µì‹  í—ˆìš©

#### **7. ê°œë°œ ì›Œí¬í”Œë¡œìš°**

1. **ì‚¬ì´íŠ¸ ì„ íƒ**: `run_single_server.py`ë¡œ í…ŒìŠ¤íŠ¸í•  ì‚¬ì´íŠ¸ ì„ íƒ
2. **API ê°œë°œ**: í•´ë‹¹ ì‚¬ì´íŠ¸ì˜ views.py, serializers.py ìˆ˜ì •
3. **í…ŒìŠ¤íŠ¸**: ì‚¬ì´íŠ¸ë³„ ì „ìš© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
4. **í†µí•© í…ŒìŠ¤íŠ¸**: ëª¨ë“  ì‚¬ì´íŠ¸ê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

ì´ ì„¤ì •ì„ í†µí•´ ë¡œì»¬ì—ì„œë„ í”„ë¡œë•ì…˜ê³¼ ë™ì¼í•œ ë©€í‹°ì‚¬ì´íŠ¸ í™˜ê²½ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 16. í˜ì´ì§€ë„¤ì´ì…˜ ê·œì¹™ (ì¤‘ìš”!)

### **ê¸°ë³¸ ì›ì¹™**
- **ëª¨ë“  ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ APIëŠ” ë°˜ë“œì‹œ í˜ì´ì§€ë„¤ì´ì…˜ì„ ì§€ì›í•´ì•¼ í•œë‹¤.**
- **í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `page`ì™€ `pageSize` íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•œë‹¤.**
- **ë°±ì—”ë“œì—ì„œ í˜ì´ì§€ë„¤ì´ì…˜ì„ ì²˜ë¦¬í•˜ê³ , í”„ë¡ íŠ¸ì—”ë“œì— í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ë¥¼ ì œê³µí•œë‹¤.**

### **íŒŒë¼ë¯¸í„° ê·œì¹™**
```python
# í•„ìˆ˜ íŒŒë¼ë¯¸í„°
page = request.query_params.get('page', 1)        # í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸ê°’: 1)
page_size = request.query_params.get('pageSize', 20)  # í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜ (ê¸°ë³¸ê°’: 20)

# íŒŒë¼ë¯¸í„° ìœ íš¨ì„± ê²€ì‚¬
try:
    page_size = int(page_size)
    if page_size < 1 or page_size > 100:  # ìµœëŒ€ 100ê°œë¡œ ì œí•œ
        page_size = 20
except ValueError:
    page_size = 20

try:
    page = int(page)
    if page < 1:
        page = 1
except ValueError:
    page = 1
```

### **Django í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„**
```python
from django.core.paginator import Paginator, EmptyPage, PageNotAnInteger

def list(self, request, *args, **kwargs):
    """ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜ í¬í•¨)"""
    try:
        # í˜ì´ì§€ë„¤ì´ì…˜ íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
        page = request.query_params.get('page', 1)
        page_size = request.query_params.get('pageSize', 20)
        
        # íŒŒë¼ë¯¸í„° ìœ íš¨ì„± ê²€ì‚¬
        try:
            page_size = int(page_size)
            if page_size < 1 or page_size > 100:
                page_size = 20
        except ValueError:
            page_size = 20
        
        try:
            page = int(page)
            if page < 1:
                page = 1
        except ValueError:
            page = 1
        
        # ì¿¼ë¦¬ì…‹ ê°€ì ¸ì˜¤ê¸°
        queryset = self.get_queryset()
        total_count = queryset.count()
        
        # í˜ì´ì§€ë„¤ì´ì…˜ ì²˜ë¦¬
        paginator = Paginator(queryset, page_size)
        
        try:
            page_obj = paginator.page(page)
        except PageNotAnInteger:
            page_obj = paginator.page(1)
            page = 1
        except EmptyPage:
            page_obj = paginator.page(paginator.num_pages)
            page = paginator.num_pages
        
        # ì‹œë¦¬ì–¼ë¼ì´ì €ë¡œ ë°ì´í„° ë³€í™˜
        serializer = self.get_serializer(page_obj, many=True)
        
        # í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ êµ¬ì„±
        pagination_info = {
            'current_page': page,
            'page_size': page_size,
            'total_count': total_count,
            'total_pages': paginator.num_pages,
            'has_next': page_obj.has_next(),
            'has_previous': page_obj.has_previous(),
            'next_page': page_obj.next_page_number() if page_obj.has_next() else None,
            'previous_page': page_obj.previous_page_number() if page_obj.has_previous() else None,
            'start_index': page_obj.start_index(),
            'end_index': page_obj.end_index()
        }
        
        # ì‘ë‹µ ë°ì´í„° êµ¬ì„±
        response_data = create_success_response({
            'items': serializer.data,  # ì‹¤ì œ ë°ì´í„°
            'pagination': pagination_info  # í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´
        })
        return Response(response_data)
        
    except Exception as e:
        response_data = create_error_response(f'ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}')
        return Response(response_data, status=status.HTTP_500_INTERNAL_SERVER_ERROR)
```

### **API ì‘ë‹µ í˜•ì‹**
```json
{
  "IndeAPIResponse": {
    "ErrorCode": "00",
    "Message": "ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
    "Result": {
      "items": [
        // ì‹¤ì œ ë°ì´í„° í•­ëª©ë“¤
      ],
      "pagination": {
        "current_page": 1,
        "page_size": 20,
        "total_count": 150,
        "total_pages": 8,
        "has_next": true,
        "has_previous": false,
        "next_page": 2,
        "previous_page": null,
        "start_index": 1,
        "end_index": 20
      }
    }
  }
}
```

### **í”„ë¡ íŠ¸ì—”ë“œ ì‚¬ìš© ì˜ˆì‹œ**
```javascript
// React/JavaScript ì˜ˆì‹œ
const fetchItems = async (page = 1, pageSize = 20) => {
  try {
    const response = await fetch(
      `/api/admin/items/?page=${page}&pageSize=${pageSize}`,
      {
        headers: {
          'Authorization': `Bearer ${accessToken}`
        }
      }
    );
    
    const data = await response.json();
    
    if (data.IndeAPIResponse.ErrorCode === '00') {
      const { items, pagination } = data.IndeAPIResponse.Result;
      
      // ë°ì´í„° ì²˜ë¦¬
      setItems(items);
      setPagination(pagination);
      
      // í˜ì´ì§€ë„¤ì´ì…˜ UI ì—…ë°ì´íŠ¸
      setCurrentPage(pagination.current_page);
      setTotalPages(pagination.total_pages);
      setTotalCount(pagination.total_count);
    }
  } catch (error) {
    console.error('ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
  }
};

// í˜ì´ì§€ ë³€ê²½ ì‹œ
const handlePageChange = (newPage) => {
  fetchItems(newPage, pagination.page_size);
};

// í˜ì´ì§€ í¬ê¸° ë³€ê²½ ì‹œ
const handlePageSizeChange = (newPageSize) => {
  fetchItems(1, newPageSize); // ì²« í˜ì´ì§€ë¶€í„° ì‹œì‘
};
```

### **í˜ì´ì§€ë„¤ì´ì…˜ ì»´í¬ë„ŒíŠ¸ ì˜ˆì‹œ**
```jsx
const PaginationComponent = ({ pagination, onPageChange, onPageSizeChange }) => {
  const { current_page, total_pages, page_size, total_count } = pagination;
  
  return (
    <div className="pagination">
      <div className="pagination-info">
        ì´ {total_count}ê°œ í•­ëª©, {current_page} / {total_pages} í˜ì´ì§€
      </div>
      
      <div className="pagination-controls">
        <button 
          onClick={() => onPageChange(current_page - 1)}
          disabled={current_page <= 1}
        >
          ì´ì „
        </button>
        
        <span>{current_page}</span>
        
        <button 
          onClick={() => onPageChange(current_page + 1)}
          disabled={current_page >= total_pages}
        >
          ë‹¤ìŒ
        </button>
      </div>
      
      <select 
        value={page_size} 
        onChange={(e) => onPageSizeChange(parseInt(e.target.value))}
      >
        <option value={10}>10ê°œì”©</option>
        <option value={20}>20ê°œì”©</option>
        <option value={50}>50ê°œì”©</option>
        <option value={100}>100ê°œì”©</option>
      </select>
    </div>
  );
};
```

### **ì ìš© ëŒ€ìƒ API**
- **ê¸°ë³¸ CRUD**: `list()` ë©”ì„œë“œ (GET /api/admin/items/)
- **ì»¤ìŠ¤í…€ ì•¡ì…˜**: `pending_items()`, `recent_items()` ë“± ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ ì•¡ì…˜
- **ê²€ìƒ‰ ê²°ê³¼**: ê²€ìƒ‰ APIì˜ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸
- **í•„í„°ë§ ê²°ê³¼**: í•„í„°ë§ëœ ë°ì´í„° ë¦¬ìŠ¤íŠ¸

### **í˜ì´ì§€ë„¤ì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] `page`ì™€ `pageSize` íŒŒë¼ë¯¸í„° ë°›ê¸°
- [ ] íŒŒë¼ë¯¸í„° ìœ íš¨ì„± ê²€ì‚¬ (1~100 ë²”ìœ„)
- [ ] Django `Paginator` ì‚¬ìš©
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ í¬í•¨í•˜ì—¬ ì‘ë‹µ
- [ ] ì˜¤ë¥˜ ì²˜ë¦¬ (PageNotAnInteger, EmptyPage)
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í˜ì´ì§€ë„¤ì´ì…˜ UI êµ¬í˜„

### **PHP ë¡œì§ ë³€í™˜ ê·œì¹™**
- `$pageByRecord` â†’ `pageSize` (í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜)
- `$pageNo` â†’ `page` (í˜ì´ì§€ ë²ˆí˜¸)
- Django í”„ë ˆì„ì›Œí¬ì˜ ê¸°ë³¸ í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ì²˜ë¦¬